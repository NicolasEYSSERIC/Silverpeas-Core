var SilverChat=null;!function($){"use strict";function _removeDiacritics(str){for(var defaultDiacriticsRemovalMap=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}],i=0;i<defaultDiacriticsRemovalMap.length;i++)str=str.replace(defaultDiacriticsRemovalMap[i].letters,defaultDiacriticsRemovalMap[i].base);return str}if("undefined"!=typeof jsxc&&null!==jsxc){window.webContext||(window.webContext=".");var chatPath=window.webContext+"/chat";SilverChat={settings:{url:"http://im.silverpeas.net:5280/http-bind/",ice:null,id:"",password:"",domain:"im.silverpeas.net",language:"",path:chatPath,avatar:null,selectUser:null,forceRemote:!1,debug:!1},init:function(options){options&&(this.settings=$.extend(!0,this.settings,options),this.settings.path+="/jsxc"),window.top.addEventListener("beforeunload",function(){jsxc.gui.changePresence("offline",!0),setTimeout(function(){jsxc.xmpp.logout(!0),jsxc.xmpp.disconnected(),jsxc.error("Disconnected before leaving page")},0)},!1),jsxc.storage.setItem("debug",this.settings.debug),SilverChat.settings.forceRemote&&(jsxc.xmpp.bookmarks.load=function(){jsxc.debug("Force to load group chats from remote"),jsxc.xmpp.bookmarks.loadFromRemote()},jsxc.xmpp.bookmarks.add=function(room,alias,nick,autojoin){jsxc.debug("Force to add group chat to remote"),jsxc.xmpp.bookmarks.addToRemote(room,alias,nick,autojoin)});var jsxcOptions={app_name:"Silverpeas",logoutElement:$("#logout"),root:this.settings.path,autoLang:0===this.settings.language.length,defaultLang:this.settings.language.length>0?this.settings.language:jsxc.options.defaultLang,otr:{enable:!1},xmpp:{url:this.settings.url,domain:this.settings.domain,overwrite:!0,resource:"SilverChat",searchDomain:this.settings.searchDomain},favicon:{enable:!1},defaultAvatar:function(jid){var data=jsxc.storage.getUserItem("buddy",jid);if(null!==data&&"groupchat"===data.type)return void jsxc.gui.avatarPlaceholder($(this).find(".jsxc_avatar"),jid);var el=$(this),avatar=new Image;avatar.onerror=function(){jsxc.gui.avatarPlaceholder(el.find(".jsxc_avatar"),jid)},avatar.onload=function(){el.find(".jsxc_avatar").removeAttr("style"),el.find(".jsxc_avatar").css({"background-image":"url("+avatar.src+")","text-indent":"999px"})},"function"==typeof SilverChat.settings.avatar?avatar.src=SilverChat.settings.avatar.call(jid):"string"==typeof SilverChat.settings.avatar?avatar.src=SilverChat.settings.avatar+"/"+Strophe.getNodeFromJid(jid)+".jpg":avatar.onerror()}};if(null!==SilverChat.settings.ice&&(jsxcOptions.RTCPeerConfig={iceServers:[{urls:"stun:"+SilverChat.settings.ice.server},{urls:"turn:"+SilverChat.settings.ice.server}]},SilverChat.settings.ice.auth)){var id=SilverChat.settings.id,password=SilverChat.settings.password;SilverChat.settings.ice.user&&(id=SilverChat.settings.ice.user,password=SilverChat.settings.ice.password),jsxcOptions.RTCPeerConfig.iceServers[1].username=id,jsxcOptions.RTCPeerConfig.iceServers[1].credential=password,jsxcOptions.RTCPeerConfig.iceServers[1].credentialType="password"}return jsxc.init(jsxcOptions),this},start:function(){return jsxc.start(this.settings.id+"@"+this.settings.domain,this.settings.password),this},connect:function(){return jsxc.xmpp.login(this.settings.id+"@"+this.settings.domain,this.settings.password),this},disconnect:function(){return jsxc.gui.changePresence("offline",!0),setTimeout(function(){jsxc.xmpp.logout(!1)}),this},isConnected:function(){return null!==jsxc.xmpp.conn}},SilverChat.gui={roster:{BUDDIES:1,TALKS:2,NO_MENU:3,_MENU:4,DEFAULT:1,selection:{buddies:[],add:function(bid,callback){for(var i=0;i<this.buddies.length;i++)if(this.buddies[i]===bid)return this;return this.buddies.push(bid),callback&&callback(),this},remove:function(bid,callback){if(bid){for(var i=0;i<this.buddies.length;i++)if(this.buddies[i]===bid){this.buddies.splice(i,1),callback&&callback();break}}else this.buddies.length=0,callback&&callback();return this},size:function(){return this.buddies.length},empty:function(){return 0===this.buddies.length}},toggleMenu:function(){var actual=jsxc.storage.getUserItem("roster_content");actual>this._MENU?this.selectTab(this.NO_MENU):(jsxc.options.get("muteNotification")?$("#manage_notifications").addClass("mute"):$("#manage_notifications").removeClass("mute"),actual=this._maskOnceMenuIsShown(actual),this._switchContentTo("#silverchat_roster_menu"),jsxc.storage.setUserItem("roster_content",actual))},selectTab:function(){var toTab=jsxc.storage.getUserItem("roster_content");toTab||(toTab=this.DEFAULT),arguments.length>0&&(toTab=arguments[0]===this.NO_MENU?this._maskOnceMenuIsHidden(toTab):arguments[0]);var currentElt,otherElt;switch(toTab){case this.BUDDIES:currentElt="#silverchat_buddies_filter",otherElt="#silverchat_groupchats_filter";break;case this.TALKS:currentElt="#silverchat_groupchats_filter",otherElt="#silverchat_buddies_filter";break;default:jsxc.error("Unknown roster tab:"+toTab),toTab=this.DEFAULT,this.selectTab(toTab)}$(currentElt).addClass("selected"),$(otherElt).removeClass("selected"),this._filter(toTab),this._switchContentTo("#silverchat_roster_chats"),jsxc.storage.setUserItem("roster_content",toTab)},_maskOnceMenuIsHidden:function(id){return id&this.NO_MENU},_maskOnceMenuIsShown:function(id){return id|this._MENU},_switchContentTo:function(elt){$(".silverchat_roster_content").removeClass("jsxc_state_shown").addClass("jsxc_state_hidden"),$(elt).removeClass("jsxc_state_hidden").addClass("jsxc_state_shown")},_filter:function(contentType){jsxc.gui.showInBuddyList(contentType===this.BUDDIES?"chat":"groupchat")}},init:function(){function clearSelection(){SilverChat.gui.roster.selection.remove(),$(".jsxc_rosteritem.selected").removeClass("selected"),$("#new_talk").addClass("jsxc_disabled")}$(document).on("ready.roster.jsxc",function(){jsxc.notification.isNotificationEnabled()?$("#manage_notifications").removeClass("mute"):$("#manage_notifications").addClass("mute"),"function"!=typeof SilverChat.settings.selectUser&&$("#search_user").remove(),SilverChat.gui.roster.selectTab(SilverChat.gui.roster.NO_MENU)}),$(document).on("add.roster.jsxc",function(event,bid,buddy,rosteritem){jsxc.debug("A new "+buddy.type+" is added in the roster",buddy.jid),"groupchat"!==buddy.type&&("none"!==buddy.sub&&rosteritem.find(".jsxc_delete").remove(),rosteritem.off("click"),rosteritem.click(function(event){if(event.ctrlKey){var data=jsxc.storage.getUserItem("buddy",bid);if(null===data||"none"===data.sub)return;rosteritem.hasClass("selected")?SilverChat.gui.roster.selection.remove(bid,function(){rosteritem.removeClass("selected")}).empty()&&($("#new_talk").addClass("jsxc_disabled"),$(".silverchat_invite").parent().addClass("jsxc_disabled")):1===SilverChat.gui.roster.selection.add(bid,function(){rosteritem.addClass("selected")}).size()&&($("#new_talk").removeClass("jsxc_disabled"),$(".silverchat_invite").parent().removeClass("jsxc_disabled"))}else clearSelection(),jsxc.gui.window.open(bid)})),SilverChat.gui.roster.selectTab(SilverChat.gui.roster.NO_MENU)}),$(document).on("receive.invitation.silverchat",function(event,buddy,roomjid,subject){var name=Strophe.getNodeFromJid(roomjid);jsxc.debug("Invation to "+name+" received from "+buddy+' for "'+subject+'"'),jsxc.gui.window.clear(roomjid),jsxc.storage.setUserItem("member",roomjid,{}),jsxc.muc.join(roomjid,Strophe.getNodeFromJid(jsxc.xmpp.conn.jid),null,name,subject,!0,!0),jsxc.gui.window.open(roomjid),jsxc.notification.notify({title:$.t("New_invitation",{sender:buddy,room:name}),msg:subject||"",source:buddy})}),$(document).on("init.window.jsxc",function(event,chatWindow){null===SilverChat.settings.ice&&(jsxc.debug("ICE service not found: video chat disabled!"),chatWindow.find(".jsxc_video").remove());var type=chatWindow.hasClass("jsxc_groupchat")?"groupchat":"chat";"groupchat"===type&&chatWindow.find(".jsxc_menu ul").prepend($("<li>").append($("<a>").attr("href","#").addClass("jsxc_disabled").click(function(){if(!$(this).hasClass("jsxc_disabled")){var room=chatWindow.data("bid"),roomdata=jsxc.storage.getUserItem("buddy",room);jsxc.muc.invite(SilverChat.gui.roster.selection.buddies,room,roomdata.subject||""),clearSelection()}}).append($("<span>").addClass("silverchat_invite").text($.t("Invite_To_Talk"))))),chatWindow.find(".jsxc_textinput").keyup(function(){if(jsxc.xmpp.conn){var now=(new Date).getTime(),last=chatWindow.data("composing-timestamp");if(!last||now-last>900){var bid=chatWindow.attr("data-bid");jsxc.xmpp.conn.chatstates.sendComposing(bid,type),chatWindow.data("composing-timestamp",now)}}})}),$("#silverchat_roster_menu_toggle").click(function(){SilverChat.gui.roster.toggleMenu()}),$("#silverchat_buddies_filter").click(function(){SilverChat.gui.roster.selectTab(SilverChat.gui.roster.BUDDIES)}),$("#silverchat_groupchats_filter").click(function(){SilverChat.gui.roster.selectTab(SilverChat.gui.roster.TALKS)}),$("#manage_notifications").click(function(){"dnd"!==jsxc.storage.getUserItem("presence")&&("granted"!==window.Notification.permission?window.Notification.requestPermission().then(function(status){switch(status){case"granted":jsxc.notification.enableNotification();break;case"denied":jsxc.notification.disableNotification()}}):jsxc.notification.isNotificationEnabled()?jsxc.notification.disableNotification():jsxc.notification.enableNotification())}),$("#search_user").click(function(){SilverChat.settings.selectUser(function(jid,alias){jsxc.debug("Add user "+jid+" into my roster");var bid=jsxc.jidToBid(jid);if(jsxc.storage.getUserItem("buddylist").indexOf(bid)<0)if(jsxc.master){var iq=$iq({type:"set"}).c("query",{xmlns:"jabber:iq:roster"}).c("item",{jid:jid,name:alias||Strophe.getNodeFromJid(jid)}).c("group").t("xmpp");jsxc.xmpp.conn.sendIQ(iq),jsxc.storage.removeUserItem("add_"+bid)}else jsxc.storage.setUserItem("add_"+bid,{username:jid,alias:alias||Strophe.getNodeFromJid(jid)});else jsxc.gui.window.open(bid)})}),$("#new_talk").click(function(){if(!$(this).hasClass("jsxc_disabled")){var dialog=jsxc.gui.dialog.open(jsxc.gui.template.get("chatroom")),$room=dialog.find("#jsxc_room");$room.attr("title",$.t("Chat_room_name_pattern")).focus(),$("#new_talk_form").submit(function(event){event.preventDefault();var name=$room.val()||Strophe.getNodeFromJid(jsxc.xmpp.conn.jid)+"_"+(new Date).getTime(),subject=$("#jsxc_dialog #jsxc_subject").val()||"",room=jsxc.muc.newRoom(name,subject,!0);jsxc.muc.invite(SilverChat.gui.roster.selection.buddies,room,subject),clearSelection()})}})}},jsxc.gui.template.chatroom='<h3 data-i18n="New_Talk"></h3>\n<div class="form-horizontal">\n  <form id="new_talk_form">\n  <div class="form-group">\n      <label class="col-sm-4 control-label" for="jsxc_room" data-i18n="Group_Chat"></label>\n      <div class="col-sm-8">\n         <input type="text" name="room" id="jsxc_room" class="form-control" autocomplete="off"\n                pattern="^[^\\x27\\x22&\'\\\\\\/:,;!\\?<>@\\s\\u00C0-\\u017F]+" autofocus />\n      </div>\n   </div>\n  <div class="form-group">\n      <label class="col-sm-4 control-label" for="jsxc_subject" data-i18n="Reason"></label>\n      <div class="col-sm-8">\n         <input type="text" name="subject" id="jsxc_subject" class="form-control" autocomplete="off" />\n      </div>\n   </div>\n  <div class="jsxc_msg"></div>\n  <br/>\n   <div class="form-group">\n      <div class="col-sm-offset-4 col-sm-8">\n         <span class="jsxc_warning"></span>\n         <button class="btn btn-default jsxc_close" data-i18n="Close"></button>\n         <button class="btn btn-success jsxc_confirm" data-i18n="Confirm"></button>\n      </div>\n   </div>\n  </form>\n</div>',jsxc.gui.template.newchat='<h3 data-i18n="New_Talk"></h3>\n<p>\n  <span data-i18n="You_have_received_message_from_"></span><b class="jsxc_their_jid"></b>.\n</p>\n<button class="btn btn-primary jsxc_approve pull-right" data-i18n="Approve"></button>\n<button class="btn btn-default jsxc_deny pull-right" data-i18n="Deny"></button>\n',jsxc.gui.template.roster='<div id="silverchat_roster">\n\n  <!-- the roaster\'s header (the title bar) -->\n  <div id="silverchat_roster_header" class="silverchat_roster_toggle">\n    <span class="silverchat_logo"></span>\n    <div id="silverchat_notice">\n      <span></span>\n    </div>\n  </div>\n\n  <!-- the roaster\'s body (its content) -->\n  <div id="silverchat_roster_body">\n\n    <!-- two tabs: one listing the buddies of the connected user, another listing the group chats -->\n    <div id="silverchat_roster_tabs">\n      <a id="silverchat_buddies_filter" data-i18n="Buddies"></a>\n      <a id="silverchat_groupchats_filter" data-i18n="Group Chats"></a>\n      <span id="silverchat_roster_menu_toggle"></span>\n    </div>\n\n    <!-- the content of the active tab -->\n    <div id="silverchat_roster_content">\n\n      <!-- first, the content of the roaster menu overrides the content of the active tab -->\n      <div id="silverchat_roster_menu" class="silverchat_roster_content jsxc_state_hidden">\n        <div class="silverchat_title" data-i18n="Menu"></div>\n        <span id="search_user" class="silverchat_menu_item" data-i18n="Search_user"></span>\n        <span id="manage_notifications" class="silverchat_menu_item" data-i18n="Notifications"></span>\n        <div class="jsxc-content-separator"></div>\n        <span id="new_talk" class="silverchat_menu_item jsxc_disabled" data-i18n="New_Talk"></span>\n      <!--  <span id="invite_talk" class="silverchat_menu_item jsxc_disabled" data-i18n="Invite_To_Talk"></span> -->\n        <div class="jsxc-content-separator"></div>\n        <div class="silverchat_title" data-i18n="Events"></div>\n        <div id="jsxc_notice">\n          <span></span>\n          <div class="jsxc_inner">\n            <ul class="silverchat_menu_item"></ul>\n          </div>\n        </div>\n      </div>\n\n      <!-- jsxc renders into a single container both the buddies and the connected groupchats -->\n      <div id="silverchat_roster_chats" class="silverchat_roster_content">\n        <ul id="jsxc_buddylist"></ul>\n      </div>\n    </div>\n\n  </div>\n\n  <div id="silverchat_roster_footer" class="jsxc_bottom jsxc_presence jsxc_rosteritem" data-bid="own">\n    <div id="jsxc_presence">\n      <span data-i18n="Offline">Offline</span>\n      <div class="jsxc_inner">\n        <ul>\n          <li data-pres="online" class="jsxc_online" data-i18n="Online"></li>\n          <li data-pres="chat" class="jsxc_chat" data-i18n="Chatty"></li>\n          <li data-pres="away" class="jsxc_away" data-i18n="Away"></li>\n          <li data-pres="xa" class="jsxc_xa" data-i18n="Extended_away"></li>\n          <li data-pres="dnd" class="jsxc_dnd" data-i18n="dnd"></li>\n          <li data-pres="offline" class="jsxc_offline" data-i18n="Offline"></li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n',jsxc.gui.template.usersearch='<h3 data-i18n="Search_User"></h3>\n<div class="form-horizontal">\n  <form id="user_search_form">\n    <div class="form-group">\n      <label class="col-sm-4 control-label" for="user_id" data-i18n="Username"></label>\n      <div class="col-sm-8">\n        <input type="text" name="room" id="user_id" class="form-control" autocomplete="on" autofocus />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="jsxc_error has-error"></div>\n      <div class="col-sm-8" id="found_users"></div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-offset-4 col-sm-8">\n        <button class="btn btn-default jsxc_close" data-i18n="Close"></button>\n      </div>\n    </div>\n  </form>\n</div>',$(document).off("init.window.jsxc",jsxc.muc.initWindow).on("init.window.jsxc",function(event,win){jsxc.muc.initWindow(event,win);var conf=win.find(".jsxc_settings ul li a.jsxc_configure");conf.length>=1&&conf.parent().remove()}),$(document).on("attached.jsxc",function(){jsxc.xmpp.conn.addHandler(jsxc.xmpp.onComposing,"http://jabber.org/protocol/chatstates","message"),"undefined"!=typeof jsxc.xmpp.conn.bookmarks&&null!=jsxc.xmpp.conn.bookmarks&&(jsxc.xmpp.conn.bookmarks.add=function(roomJid,alias,nick,autojoin,success,error){function bookmarkGroupChat(bookmarkit){if(bookmarkit){var conferenceAttr={jid:roomJid,autojoin:autojoin||!1};alias&&(conferenceAttr.name=alias),stanza.c("conference",conferenceAttr),nick&&stanza.c("nick").t(nick)}self.connection.sendIQ(stanza,success,error)}var self=this,stanza=$iq({type:"set"}).c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("publish",{node:Strophe.NS.BOOKMARKS}).c("item",{id:"current"}).c("storage",{xmlns:Strophe.NS.BOOKMARKS});self.get(function(s){for(var confs=s.getElementsByTagName("conference"),bookmarked=!1,i=0;i<confs.length;i++){var conferenceAttr={jid:confs[i].getAttribute("jid"),autojoin:confs[i].getAttribute("autojoin")||!1},roomName=confs[i].getAttribute("name"),nickname=confs[i].getElementsByTagName("nick");conferenceAttr.jid===roomJid?(bookmarked=!0,conferenceAttr.autojoin=autojoin||!1,alias&&(conferenceAttr.name=alias),stanza.c("conference",conferenceAttr),nick&&stanza.c("nick").t(nick).up()):(roomName&&(conferenceAttr.name=roomName),stanza.c("conference",conferenceAttr),1===nickname.length&&stanza.c("nick").t(nickname[0].innerHTML).up()),stanza.up()}bookmarkGroupChat(!bookmarked)},function(s){s.getElementsByTagName("item-not-found").length>0?(bookmarkGroupChat(!0),self.connection.sendIQ(stanza,success,error)):error(s)})},jsxc.xmpp.conn.bookmarks.delete=function(roomJid,success,error){var self=this,stanza=$iq({type:"set"}).c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("publish",{node:Strophe.NS.BOOKMARKS}).c("item",{id:"current"}).c("storage",{xmlns:Strophe.NS.BOOKMARKS});self.get(function(s){for(var confs=s.getElementsByTagName("conference"),i=0;i<confs.length;i++){var conferenceAttr={jid:confs[i].getAttribute("jid"),autojoin:confs[i].getAttribute("autojoin")||!1};if(conferenceAttr.jid!==roomJid){var roomName=confs[i].getAttribute("name");roomName&&(conferenceAttr.name=roomName),stanza.c("conference",conferenceAttr);var nickname=confs[i].getElementsByTagName("nick");1===nickname.length&&stanza.c("nick").t(nickname[0].innerHTML).up(),stanza.up()}}self.connection.sendIQ(stanza,success,error)},function(s){error(s)})})}),jsxc.gui.roster.init=function(){var roster=jsxc.gui.template.get("roster");if(0===$("#"+roster.attr("id")).length){$(jsxc.options.rosterAppend+":first").append(roster),jsxc.options.get("hideOffline")&&$("#jsxc_buddylist").addClass("jsxc_hideOffline"),SilverChat.gui.init(),$("#silverchat_roster_header.silverchat_roster_toggle").click(function(){jsxc.gui.roster.toggle()}),$("#jsxc_presence li").click(function(){var self=$(this),pres=self.data("pres");switch(pres){case"offline":jsxc.gui.changePresence(pres,!0),setTimeout(function(){SilverChat.disconnect()},0);break;case"online":SilverChat.connect(),jsxc.gui.changePresence(pres,!0);break;default:jsxc.gui.changePresence(pres)}}),$("#jsxc_buddylist").slimScroll({distance:"3px",width:$("#jsxc_buddylist").width()+"px",color:"#fff",opacity:"0.5"}),$("#silverchat_roster > .jsxc_bottom > div").each(function(){jsxc.gui.toggleList.call($(this))});var rosterState=jsxc.storage.getUserItem("roster")||"hidden";$("#silverchat_roster").addClass("jsxc_state_"+rosterState),$("#jsxc_windowList").addClass("jsxc_roster_"+rosterState);var pres=jsxc.storage.getUserItem("presence")||"online";$("#jsxc_presence > span").text($("#jsxc_presence .jsxc_"+pres).text()),jsxc.gui.updatePresence("own",pres),jsxc.gui.tooltip("#silverchat_roster"),jsxc.notice.load(),jsxc.gui.roster.ready=!0,$(document).trigger("ready.roster.jsxc")}},jsxc.gui.roster.toggle=function(state){var duration,roster=$("#silverchat_roster"),wl=$("#jsxc_windowList");return state||(state=jsxc.storage.getUserItem("roster")===jsxc.CONST.HIDDEN?jsxc.CONST.SHOWN:jsxc.CONST.HIDDEN),jsxc.storage.setUserItem("roster",state),roster.removeClass("jsxc_state_hidden jsxc_state_shown").addClass("jsxc_state_"+state),wl.removeClass("jsxc_roster_hidden jsxc_roster_shown").addClass("jsxc_roster_"+state),duration=1e3*parseFloat(roster.css("transitionDuration")||0),setTimeout(function(){jsxc.gui.updateWindowListSB()},duration),$(document).trigger("toggle.roster.jsxc",[state,duration]),duration},jsxc.gui.showInBuddyList=function(type){return"groupchat"!==type&&"chat"!==type?void jsxc.error("Unknown jsxc data type in buddy list:"+type):void $("#jsxc_buddylist li.jsxc_rosteritem").each(function(){$(this).data("type")===type?$(this).show():$(this).hide()})},jsxc.gui.showUnknownSender=function(bid){jsxc.gui.dialog.open(jsxc.gui.template.get("newchat"),{noClose:!0}),$("#jsxc_dialog .jsxc_their_jid").text(Strophe.getNodeFromJid(bid)),$("#jsxc_dialog .jsxc_deny").click(function(){jsxc.storage.removeUserItem("chat",bid),jsxc.gui.dialog.close()}),$("#jsxc_dialog .jsxc_approve").click(function(){jsxc.gui.dialog.close(),jsxc.storage.saveBuddy(bid,{jid:bid,name:Strophe.getNodeFromJid(bid),status:0,sub:"none",res:[]});for(var chat=jsxc.storage.getUserItem("chat",bid)||[],i=0;i<chat.length;i++)jsxc.gui.window.postMessage(chat[i]);jsxc.storage.removeUserItem("chat",bid),jsxc.gui.window.open(bid)})},jsxc.notification.__notify=jsxc.notification.notify,jsxc.notification.notify=function(title,msg,d,force,soundFile,loop,source){this.isNotificationEnabled()&&(jsxc.debug("Notification is enabled, notify!"),jsxc.notification.__notify(title,msg,d,force,soundFile,loop,source))},jsxc.notification.isNotificationEnabled=function(){return 1===jsxc.storage.getUserItem("notification")},jsxc.notification.disableNotification=function(external){external!==!0&&(jsxc.debug("Disable desktop notifications"),$("#manage_notifications").addClass("mute"),jsxc.options.notification=!1,jsxc.storage.setUserItem("notification",0))},jsxc.notification.enableNotification=function(external){external!==!0&&(jsxc.debug("Enable desktop notifications"),$("#manage_notifications").removeClass("mute"),jsxc.notification.init(),jsxc.storage.setUserItem("notification",1))},jsxc.notice.__add=jsxc.notice.add,jsxc.notice.add=function(msg,description,fnName,fnParams,id){jsxc.notice.__add(msg,description,fnName,fnParams,id),$("#silverchat_notice > span").text(jsxc.notice._num),$("#jsxc_notice ul").addClass("silverchat_menu_item")},jsxc.notice.__remove=jsxc.notice.remove,jsxc.notice.remove=function(nid){jsxc.notice.__remove(nid),$("#silverchat_notice > span").text(jsxc.notice._num||"")},jsxc.storage.saveMessage=function(bid,direction,msg,encrypted,forwarded,stamp){var chat=jsxc.storage.getUserItem("chat",bid)||[];chat.push({bid:bid,direction:direction,msg:msg,encrypted:encrypted,forwarded:forwarded,stamp:stamp,attachment:null}),jsxc.storage.setUserItem("chat",bid,chat)},jsxc.xmpp.onComposing=function(stanza){var type=$(stanza).attr("type"),from=$(stanza).attr("from");if("groupchat"===type&&Strophe.getResourceFromJid(from)===Strophe.getNodeFromJid(jsxc.xmpp.conn.jid))return!0;var bid=jsxc.jidToBid(from),user="chat"===type?Strophe.getNodeFromJid(from):Strophe.getResourceFromJid(from);return $("#jsxc_windowList .jsxc_windowItem").each(function(){var self=$(this),winBid=self.data("bid");if(winBid===bid){var usersComposing=self.data("composing")||[];usersComposing.indexOf(user)===-1&&(usersComposing.push(user),self.data("composing",usersComposing));var textarea=self.find(".jsxc_textarea"),composingNotif=textarea.find(".silverchat_composing");jsxc.gui.window.scrollDown(winBid);var msg=usersComposing.length>1?$.t("are_composing",{name:usersComposing.join(", ")}):$.t("is_composing",{name:usersComposing[0]});composingNotif.length<1?(composingNotif=$("<div>").addClass("silverchat_composing").addClass("jsxc_chatmessage").addClass("jsxc_sys").css({opacity:0,display:"block"}).html(msg),textarea.append(composingNotif)):composingNotif.html(msg),"1"!==composingNotif.css("opacity")&&(composingNotif.animate({opacity:1},600),setTimeout(function(){composingNotif.animate({opacity:0},600,function(){composingNotif.remove()}),self.data("data",[])},3e3))}}),!0},jsxc.muc.__init=jsxc.muc.init,jsxc.muc.init=function(o){jsxc.muc.__init(o),jsxc.muc.conn.addHandler(jsxc.muc.onDirectInvitation,"jabber:x:conference","message"),$(document).on("status.muc.jsxc",function(event,code,room){if("201"===code){var roomdata=jsxc.storage.getUserItem("buddy",room);roomdata.persistent&&jsxc.muc.conn.muc.configure(room,function(stanza){jsxc.debug(stanza);for(var form=Strophe.x.Form.fromXML(stanza),i=0;i<form.fields.length;i++)switch(form.fields[i].var){case"muc#roomconfig_roomname":form.fields[i].values=[roomdata.name];break;case"muc#roomconfig_roomdesc":form.fields[i].values=[roomdata.subject];break;case"muc#roomconfig_persistentroom":form.fields[i].values=[1];break;case"muc#roomconfig_moderatedroom":form.fields[i].values=[0];break;case"muc#roomconfig_whois":form.fields[i].values=["anyone"];break;case"muc#roomconfig_allow_subscription":form.fields[i].values=[1];
break;case"muc#roomconfig_enablelogging":form.fields[i].values=[1]}jsxc.muc.conn.muc.saveConfiguration(room,form,function(){jsxc.debug("The room "+room+" is now configured")},function(response){jsxc.error("Error while configuring room "+room,response)})},function(response){jsxc.error("Error while loading configuration of room "+room,response)})}})},jsxc.muc.onDirectInvitation=function(stanza){if(!($(stanza).find("x[xmlns='"+Strophe.NS.MUC_USER+"']").length>0)){var sender=Strophe.getNodeFromJid($(stanza).attr("from")),invitation=$(stanza).find("x[xmlns='jabber:x:conference']"),roomjid=invitation.attr("jid"),reason=invitation.attr("reason")||"";return jsxc.debug("Direct invitation to the group chat "+roomjid+" received from "+sender),$(document).trigger("receive.invitation.silverchat",[sender,roomjid,reason]),!0}},jsxc.muc.invite=function(buddies,room,reason){for(var i=0;i<buddies.length;i++)jsxc.debug("Invite user "+buddies[i]+" to the group chat "+room),jsxc.muc.conn.muc.directInvite(room,buddies[i],reason||"")},jsxc.muc.newRoom=function(name,subject,persistent){if(name){var room=_removeDiacritics(name.replace(/@.+/,"").replace(/ /g,"_").toLowerCase())+"@"+jsxc.options.get("muc").server,reason=subject||"";if(jsxc.storage.setUserItem("member",room,{}),jsxc.muc.join(room,Strophe.getNodeFromJid(jsxc.xmpp.conn.jid),null,name,reason,!0,!0),persistent){var roomdata=jsxc.storage.getUserItem("buddy",room);roomdata.persistent=!0,roomdata.config=jsxc.muc.CONST.ROOMCONFIG.INSTANT,jsxc.storage.setUserItem("buddy",room,roomdata)}else jsxc.storage.updateUserItem("buddy",room,"config",jsxc.muc.CONST.ROOMCONFIG.INSTANT);return room}},I18next.fr.translation.ClearHistory="Effacer l'historique local des conversations",I18next.en.translation.ClearHistory="Clear the talk history",I18next.de.translation.ClearHistory="Clear the talk history",I18next.fr.translation.Buddies="Contacts",I18next.en.translation.Buddies="Buddies",I18next.de.translation.Buddies="Buddies",I18next.fr.translation["Group Chats"]="Discussions",I18next.en.translation["Group Chats"]="Group Chats",I18next.de.translation["Group Chats"]="Group Chats",I18next.fr.translation.Group_Chat="Discussion",I18next.en.translation.Group_Chat="Group Chat",I18next.de.translation.Group_Chat="Group Chat",I18next.fr.translation.Menu="Menu",I18next.en.translation.Menu="Menu",I18next.de.translation.Menu="Menu",I18next.fr.translation.Search_user="Rechercher un utilisateur",I18next.en.translation.Search_user="Looking for a user",I18next.de.translation.Search_user="Looking for a user",I18next.fr.translation.Notifications="Notifications",I18next.en.translation.Notifications="Notifications",I18next.de.translation.Notifications="Notifications",I18next.fr.translation.New_Talk="Nouvelle discussion",I18next.en.translation.New_Talk="New group chat",I18next.de.translation.New_Talk="New group chat",I18next.fr.translation.Invite_To_Talk="Inviter dans la discussion",I18next.en.translation.Invite_To_Talk="Invite to the group chat",I18next.de.translation.Invite_To_Talk="Invite to the group chat",I18next.fr.translation.New_invitation="__sender__ vous invite à rejoindre la discussion __room__",I18next.en.translation.New_invitation="__sender__ invite you to join him the group chat __room__",I18next.de.translation.New_invitation="__sender__ invite you to join him the group chat __room__",I18next.fr.translation.Chat_room_name_pattern="Pas d'espaces, pas de caractères accentués ou spéciaux (&\"'/:,;!?<>@)",I18next.en.translation.Chat_room_name_pattern="No spaces, no accented or specials characters (&\"'/:,;!?<>@)",I18next.de.translation.Chat_room_name_pattern="No spaces, no accented or specials characters (&\"'/:,;!?<>@)",I18next.fr.translation.is_composing="__name__ est en train d'écrire ...",I18next.en.translation.is_composing="__name__ is composing...",I18next.de.translation.is_composing="__name__ is composing...",I18next.fr.translation.are_composing="__name__ sont en train d'écrire ...",I18next.en.translation.are_composing="__name__ are composing...",I18next.de.translation.are_composing="__name__ are composing...",I18next.fr.translation.Search_User="Rechercher un utilisateur par son identifiant",I18next.en.translation.Search_User="Search a user by its identifier",I18next.de.translation.Search_User="Search a user by its identifier",I18next.fr.translation.You_have_received_message_from_="Vous avez reçu un message de ",I18next.en.translation.You_have_received_message_from_="You have received a message from ",I18next.de.translation.You_have_received_message_from_="You have received a message from ",I18next.fr.translation.Events="Evenements",I18next.en.translation.Events="Events",I18next.de.translation.Events="Events"}}(jQuery);
//# sourceMappingURL=silverchat.min.js.map